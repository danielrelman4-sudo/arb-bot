# v11 profile: LIVE TRADING — conservative starter config.
# Kalshi + ForecastEx, structural buckets + cross-venue, $100 bankroll, tight safety rails.
#
# Prerequisites:
#   export ARB_LIVE_MODE=true
#   export KALSHI_KEY_ID="your-key-id"
#   export KALSHI_PRIVATE_KEY_PATH="/path/to/private-key.pem"
#   IB Gateway running on port 4001 (live) or 4002 (paper)
#
# Run command:
#   python3 -m arb_bot.engine --profile arb_bot/config/profiles/v11_live_starter.env

# ═══════════════════════════════════════════════════════════════
# LIVE MODE
# ═══════════════════════════════════════════════════════════════
ARB_LIVE_MODE=true

# ═══════════════════════════════════════════════════════════════
# VENUES — Kalshi + ForecastEx (Polymarket not funded/configured)
# ═══════════════════════════════════════════════════════════════
KALSHI_ENABLED=true
POLYMARKET_ENABLED=false
FORECASTEX_ENABLED=true
FORECASTEX_PORT=4001
FORECASTEX_CLIENT_ID=50
FORECASTEX_CONID_CATALOG_PATH=arb_bot/config/forecastex_conid_catalog.json
FORECASTEX_FEE_PER_CONTRACT=0.005
FORECASTEX_PAYOUT_PER_CONTRACT=1.0
FORECASTEX_MARKET_LIMIT=200

# ═══════════════════════════════════════════════════════════════
# SAFETY RAILS — kill switches & loss caps
# ═══════════════════════════════════════════════════════════════
# Stop trading after $10 cumulative daily loss
ARB_DAILY_LOSS_CAP_USD=10.0
# Stop after 5 consecutive execution failures
ARB_MAX_CONSECUTIVE_FAILURES=5
# Start in canary mode — extra conservative sizing
ARB_CANARY_MODE=true
ARB_CANARY_MAX_DOLLARS_PER_TRADE=15.0
ARB_CANARY_MAX_CONTRACTS_PER_TRADE=30

# ═══════════════════════════════════════════════════════════════
# BANKROLL & SIZING
# ═══════════════════════════════════════════════════════════════
ARB_DEFAULT_BANKROLL_USD=100.0
ARB_BANKROLL_BY_VENUE=kalshi=100,forecastex=100
ARB_MAX_DOLLARS_PER_TRADE=20.0
ARB_MAX_CONTRACTS_PER_TRADE=50
ARB_MAX_BANKROLL_FRACTION_PER_TRADE=0.06
ARB_MAX_LIQUIDITY_FRACTION_PER_TRADE=0.4
ARB_ENABLE_EXECUTION_AWARE_KELLY=true
ARB_KELLY_FRACTION_CAP=0.8
ARB_KELLY_CONFIDENCE_FLOOR=0.30

# ═══════════════════════════════════════════════════════════════
# RISK LIMITS
# ═══════════════════════════════════════════════════════════════
ARB_MAX_EXPOSURE_PER_VENUE_USD=80.0
ARB_MAX_OPEN_MARKETS_PER_VENUE=30
ARB_MAX_OPEN_POSITIONS_PER_CLUSTER=6

# ═══════════════════════════════════════════════════════════════
# LANES — structural buckets + cross-venue (Kalshi↔ForecastEx)
# ═══════════════════════════════════════════════════════════════
# Intra-venue disabled (0.2c edge can't survive friction)
ARB_LANE_INTRA_ENABLED=false
# Cross-venue ON — Kalshi↔ForecastEx on shared economic events
ARB_LANE_CROSS_ENABLED=true
ARB_LANE_CROSS_MIN_NET_EDGE_PER_CONTRACT=0.005
ARB_LANE_CROSS_MIN_FILL_PROBABILITY=0.70
ARB_LANE_CROSS_MIN_REALIZED_PROFIT_USD=0.005
ARB_LANE_STRUCTURAL_PARITY_ENABLED=false
ARB_LANE_STRUCTURAL_EVENT_TREE_ENABLED=false

# Structural buckets — ON, with conservative edge thresholds
ARB_LANE_STRUCTURAL_BUCKET_ENABLED=true
ARB_LANE_STRUCTURAL_BUCKET_MIN_NET_EDGE_PER_CONTRACT=0.02
ARB_LANE_STRUCTURAL_BUCKET_MIN_EXPECTED_PROFIT_USD=0.005
ARB_LANE_STRUCTURAL_BUCKET_MIN_FILL_PROBABILITY=0.72
ARB_LANE_STRUCTURAL_BUCKET_MIN_REALIZED_PROFIT_USD=0.008

# Max 4 legs per bucket — beyond this, fill probability craters
ARB_MAX_BUCKET_LEGS=4
# Disable bucket after 3 consecutive execution failures
ARB_MAX_BUCKET_CONSECUTIVE_FAILURES=3

# ═══════════════════════════════════════════════════════════════
# FEES — Kalshi real fees
# ═══════════════════════════════════════════════════════════════
# Kalshi fee: 0.07 * P * (1-P), capped at $0.02/contract.
# For bucket trades near extremes, avg ~$0.01/contract.
# Set conservative estimate: 1.5c/contract taker fee.
KALSHI_TAKER_FEE_PER_CONTRACT=0.015

# ═══════════════════════════════════════════════════════════════
# STRUCTURAL RULES — temporal-FP-filtered v3 merged
# ═══════════════════════════════════════════════════════════════
ARB_STRUCTURAL_RULES_PATH=arb_bot/config/structural_rules.generated.v3_merged.json

# ═══════════════════════════════════════════════════════════════
# BUCKET QUALITY MODEL
# ═══════════════════════════════════════════════════════════════
ARB_BUCKET_QUALITY_ENABLED=true
ARB_BUCKET_QUALITY_HISTORY_GLOB=arb_bot/output/paper_*.csv
ARB_BUCKET_QUALITY_HISTORY_MAX_FILES=80
ARB_BUCKET_QUALITY_MIN_OBSERVATIONS=6
ARB_BUCKET_QUALITY_MAX_ACTIVE_BUCKETS=0
ARB_BUCKET_QUALITY_EXPLORE_FRACTION=0.10
ARB_BUCKET_QUALITY_PRIOR_MEAN_REALIZED_PROFIT=0.002
ARB_BUCKET_QUALITY_PRIOR_STRENGTH=14
ARB_BUCKET_QUALITY_MIN_SCORE=-0.005
ARB_BUCKET_QUALITY_LEG_COUNT_PENALTY=0.00035
ARB_BUCKET_QUALITY_LIVE_UPDATE_INTERVAL=15

# ═══════════════════════════════════════════════════════════════
# COOLDOWNS — prevent over-trading same markets
# ═══════════════════════════════════════════════════════════════
ARB_MARKET_COOLDOWN_SECONDS=1800
ARB_MARKET_COOLDOWN_SCOPE=market_side
ARB_OPPORTUNITY_COOLDOWN_SECONDS=3600

# ═══════════════════════════════════════════════════════════════
# KALSHI MARKET SCANNING
# ═══════════════════════════════════════════════════════════════
KALSHI_MARKET_LIMIT=250
KALSHI_MARKET_SCAN_PAGES=8
KALSHI_MARKET_PAGE_SIZE=100
KALSHI_USE_ORDERBOOK_QUOTES=false
KALSHI_MAX_ORDERBOOK_CONCURRENCY=1
KALSHI_REQUEST_PAUSE_SECONDS=0.4
KALSHI_MIN_LIQUIDITY=0.0
KALSHI_STREAM_SUBSCRIPTION_BATCH_SIZE=120
KALSHI_STREAM_SUBSCRIPTION_RETRY_ATTEMPTS=4
KALSHI_STREAM_SUBSCRIPTION_ACK_TIMEOUT_SECONDS=3
KALSHI_STREAM_MAX_TICKERS_PER_SOCKET=220
KALSHI_STREAM_PRIORITY_REFRESH_LIMIT=40
KALSHI_STREAM_ALLOW_REST_TOPUP=false
KALSHI_STREAM_BOOTSTRAP_SCAN_PAGES=3
KALSHI_STREAM_BOOTSTRAP_ENRICH_LIMIT=0
KALSHI_EVENTS_429_CIRCUIT_THRESHOLD=4
KALSHI_EVENTS_429_CIRCUIT_COOLDOWN_SECONDS=180

# ═══════════════════════════════════════════════════════════════
# POLLING & CADENCE
# ═══════════════════════════════════════════════════════════════
ARB_STREAM_RECOMPUTE_COOLDOWN_MS=2500
ARB_POLL_INTERVAL_SECONDS=25
ARB_UNIVERSE_HOTSET_SIZE=0
ARB_FILL_STALE_HALF_LIFE_SECONDS=300

# ═══════════════════════════════════════════════════════════════
# TIME-REGIME SWITCHING — bias toward near-term settlements
# ═══════════════════════════════════════════════════════════════
# ForecastEx expiry distribution: 40% settle within 90d, 30% in
# 91-365d, 16% beyond 1yr. We want to strongly prefer near-term
# events to avoid capital lockup, while still allowing far-term
# trades when edge is sufficiently large.
#
# "Near" = settles within 14 days — boost edge thresholds (more
#   permissive, since capital returns quickly)
# "Far" = settles beyond 60 days — penalize edge thresholds (must
#   have higher raw edge to justify capital lockup)
ARB_TIME_REGIME_ENABLED=true
ARB_TIME_REGIME_NEAR_DAYS=14.0
ARB_TIME_REGIME_FAR_DAYS=60.0
# Near-term: lower the bar — 15% edge boost, fill probability bonus
ARB_TIME_REGIME_NEAR_EDGE_MULTIPLIER=1.15
ARB_TIME_REGIME_NEAR_EXPECTED_PROFIT_MULTIPLIER=1.10
ARB_TIME_REGIME_NEAR_FILL_PROBABILITY_DELTA=0.03
ARB_TIME_REGIME_NEAR_REALIZED_PROFIT_MULTIPLIER=1.10
# Far-term: raise the bar — 25% edge penalty, fill probability malus
# (was 10% penalty; increased for ForecastEx's long-dated contracts)
ARB_TIME_REGIME_FAR_EDGE_MULTIPLIER=0.75
ARB_TIME_REGIME_FAR_EXPECTED_PROFIT_MULTIPLIER=0.75
ARB_TIME_REGIME_FAR_FILL_PROBABILITY_DELTA=-0.05
ARB_TIME_REGIME_FAR_REALIZED_PROFIT_MULTIPLIER=0.75

# ═══════════════════════════════════════════════════════════════
# CROSS-VENUE MAPPING — Kalshi↔ForecastEx
# ═══════════════════════════════════════════════════════════════
# Path to live-refreshed mapping CSV (generated by --refresh-mappings)
ARB_CROSS_VENUE_MAPPING_PATH=arb_bot/config/cross_venue_map.live.csv
